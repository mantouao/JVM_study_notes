### 1.native

**关于native的相关知识**

1. `native`关键字声明的方法：
   
   - `native`关键字用于声明Java方法，表示该方法的实现是通过本地代码来完成的。
   - 这些方法的具体实现不在Java代码中，而是在本地库中。

2. 本地方法栈（Native Method Stack）：
   
   - 本地方法栈是Java虚拟机的一部分，用于执行本地方法时的函数调用和参数传递。
   - 它类似于Java虚拟机栈，但专门用于执行本地方法的调用和返回。
   - 本地方法栈为每个线程提供独立的内存空间，用于存储本地方法的参数、局部变量和中间计算结果等。

3. 本地方法库（Native Library）：
   
   - 本地方法库是包含本地方法实现的动态链接库（DLL文件或共享对象文件）。
   - 本地方法库通常由其他语言（如C、C++）编写，其中实现了通过`native`关键字声明的Java方法。
   - 本地方法库与Java代码通过Java Native Interface（JNI）进行连接和交互。

4. 本地方法库接口：
   
   - 本地方法库接口是通过JNI定义的一组规范，用于描述Java代码与本地方法库之间的交互方式。
   - 本地方法库接口定义了Java代码如何调用本地方法，并规定了参数传递、数据类型映射等细节。
   - 通过本地方法库接口，Java代码可以与本地方法库进行交互，调用本地方法的实现。

**一个本地方法的一般执行流程**

1. Java代码中的方法调用：
   
   - 在Java代码中，调用被声明为`native`的方法。
   - Java虚拟机在解释或编译Java代码时，遇到`native`方法调用时会发出一个本地方法调用请求。

2. 本地方法调用：
   
   - Java虚拟机将控制权转移到本地方法栈。
   - 本地方法栈为当前线程创建一个本地方法栈帧，用于存储本地方法的参数、局部变量和中间计算结果等。

3. 连接本地方法库：
   
   - Java虚拟机使用Java Native Interface（JNI）连接到本地方法库。
   - 虚拟机通过JNI加载本地方法库，并建立Java代码与本地方法库的接口。

4. 本地方法执行：
   
   - Java虚拟机将控制权传递给本地方法库。
   - 本地方法库中的本地代码接收到调用请求后，执行对应的本地方法。

5. 本地方法执行过程：
   
   - 本地方法库根据本地方法的参数和需求，执行底层的本地代码逻辑。
   - 本地方法库可以使用其他语言（如C、C++）编写，利用操作系统提供的功能、硬件特性或其他原生能力。
   - 本地方法库执行完成后，返回结果（如果有）给本地方法栈。

6. 返回到Java代码：
   
   - 执行本地方法的过程完成后，控制权返回到Java代码调用点。
   - Java虚拟机将本地方法的返回值传递给Java方法的调用者。

### 2.方法区

方法区（Method Area）是Java虚拟机的一部分，也被称为永久代（Permanent Generation），用于存储类的结构信息、常量池、静态变量、即时编译器编译后的代码等数据。以下是对方法区的详细讲解：

1. 存储类的结构信息：
   
   - 方法区存储每个加载的类的结构信息，包括类的完整名称、访问修饰符、父类、接口、字段和方法等。
   - 类的结构信息包括类的层次结构、方法的签名、字段的类型和访问权限等，用于在运行时对类进行验证、解析和链接。

2. 存储常量池：
   
   - 常量池是方法区的一部分，用于存储编译期生成的字面量和符号引用。
   - 常量池包含字符串字面量、类和接口的全限定名、字段和方法的名称和描述符等信息。
   - 常量池的内容在类加载过程中被加载到方法区，并用于支持运行时的动态链接、方法调用和字段访问等操作。

3. 存储静态变量：
   
   - 静态变量属于类的状态，存储在方法区中。
   - 当类被加载时，静态变量的内存空间就会被分配，并初始化为默认值或者指定的初始值。
   - 静态变量在整个程序的生命周期内都存在，并且可以被多个对象共享。

4. 存储即时编译器编译后的代码：
   
   - 即时编译器（Just-In-Time Compiler，JIT）将热点代码（被频繁执行的代码）编译为本地机器码，以提高执行效率。
   - JIT编译器生成的代码存储在方法区中，用于替代解释执行的字节码。
   - JIT编译器会根据运行时的情况动态决定哪些代码需要被编译和优化。

### 3.程序计数器

程序计数器（Program Counter）是Java虚拟机中的一块内存区域，用于指示当前线程执行的字节码指令的位置。

- 程序计数器类似于遥控器上的指示器，在Java虚拟机中用于指示当前线程执行的字节码指令的位置。
- 程序计数器记录下一条要执行的指令的地址，并不断更新自己的值以指示下一条将要执行的指令。
- 每个线程都有自己独立的程序计数器，用于记录线程当前的执行位置。
- 在多线程环境下，程序计数器能够帮助虚拟机恢复到正确的执行位置，继续执行之前的操作。
