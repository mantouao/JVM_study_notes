# 类加载器

### 1.什么是类加载器

类加载器（Class Loader）是 Java 虚拟机（JVM）的一个重要组成部分，负责将类的字节码加载到内存中并转换为可执行的 Java 类。

### 2.有哪些类加载器

1. **启动类加载器（Bootstrap Class Loader）**：也称为根加载器，它是虚拟机的一部分，负责加载 Java 平台核心库，如 `rt.jar` 等。它是最顶层的类加载器，通常由本地代码实现（c++代码），不继承自 `java.lang.ClassLoader`。

2. **扩展类加载器（Extension Class Loader）**：也称为扩展加载器，它是负责加载 Java 平台的扩展库（`jre/lib/ext` 目录下的 JAR 文件）的类加载器。它是由 `sun.misc.Launcher$ExtClassLoader` 实现的。

3. **应用程序类加载器（Application Class Loader）**：也称为系统类加载器，它是负责加载应用程序类路径（Classpath）上指定的类和用户自定义类的加载器。它是由 `sun.misc.Launcher$AppClassLoader` 实现的。在大多数情况下，它是类加载器的默认选择。

4. **用户自定义类加载器**：除了上述内置的类加载器，Java 还提供了抽象类 `java.lang.ClassLoader`，允许用户根据自己的需求实现自定义的类加载器。用户自定义类加载器可以根据特定的加载策略从不同的来源（如文件系统、数据库、网络）加载类。

### 3.类加载的工作过程

1. **加载（Loading）**：类加载器首先根据类的全限定名（Fully Qualified Name）查找类的字节码文件。加载可以从本地文件系统、网络或其他来源获取字节码数据。

2. **链接（Linking）**：链接过程包括验证、准备和解析三个步骤。
   
   - **验证（Verification）**：验证阶段确保类的字节码符合 Java 虚拟机规范，检查字节码的正确性和安全性。
   
   - **准备（Preparation）**：准备阶段为类的静态变量分配内存空间，并设置默认初始值（零值）。
   
   - **解析（Resolution）**：解析阶段将符号引用转换为直接引用，即将类或接口的符号引用解析为内存中的实际引用。

3. **初始化（Initialization）**：初始化阶段对类进行实际的初始化操作。这包括执行静态变量的赋值和执行静态初始化块（static initializer）中的代码。初始化阶段是类加载过程中的最后一步。

### 4. 双亲委派机制

当一个类加载器收到加载类的请求时，它首先将加载任务委派给父类加载器。父类加载器会按照同样的方式继续向上委派，直到到达最顶层的启动类加载器。只有在父类加载器无法加载类时，子类加载器才会尝试加载类。这种委派机制确保了类的加载是有序的，并且提供了类加载器的隔离性和安全性。

简单来说，对于每个类加载器来说，优先让自己的父类加载器去加载字节码文件，如果父类不能加载，自己再去加载。

这些加载器的等级是：

启动类加载器是扩展类加载器的父类，扩展类加载器是应用程序加载器的父类，用户自定义类加载器要自己去定义父类类加载器

举个例子

我们去加载一个.class文件，他先去找应用程序类加载器，但是应用程序类加载器先不处理，他先交给扩展类加载器看他能不能处理，扩展类加载器同样先交给启动类加载器看是否可以处理。也就是说虽然先交给应用程序类加载器，但其实他的优先级是最低的，优先级最高的其实是启动类加载器。


